---
import type { Diagnostic } from '@/types';

interface Props {
  diagnostic: Diagnostic;
}

const { diagnostic } = Astro.props;

const statusColors = {
  healthy: 'bg-tag-healthy text-white',
  low: 'bg-tag-low text-state-idle',
  moderate: 'bg-tag-mid text-white',
  severe: 'bg-tag-severe text-white'
};

const statusColor = statusColors[diagnostic.status];

const formatDate = (date: Date): string => {
  const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                  'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
  return `${date.getDate()} de ${months[date.getMonth()]}, ${date.getFullYear()}`;
};

const formattedDate = formatDate(diagnostic.predictedAt);
const title = diagnostic.statusLabel === 'Sin rancha' ? 'Hoja sana' : 'Hoja infectada';
---

<div class="bg-gray-50 rounded-lg border border-outline overflow-hidden hover:shadow-md transition-shadow">
  <div class="aspect-square bg-gray-200 relative">
    <div class="absolute inset-0 flex items-center justify-center text-state-disabled">
      <i class="fas fa-leaf text-4xl opacity-20"></i>
    </div>
  </div>
  
  <div class="p-3">
    <h3 class="font-semibold text-state-idle text-sm mb-2">
      {title}
    </h3>
    
    <span class={`inline-block px-2 py-1 rounded text-xs font-medium mb-2 ${statusColor}`}>
      {diagnostic.statusLabel}
    </span>
    
    <p class="text-xs text-state-disabled mb-1">
      <i class="fas fa-map-marker-alt mr-1"></i>
      {diagnostic.location || 'Sin parcela'}
    </p>
    
    <p class="text-xs text-state-disabled mb-3">
      {formattedDate}
    </p>
    
    <a 
      href={`/diagnostico/${diagnostic.predictionId}`}
      class="text-state-idle text-xs hover:underline inline-flex items-center gap-1"
    >
      Ver detalles
      <i class="fas fa-arrow-right text-xs"></i>
    </a>
  </div>
</div>
