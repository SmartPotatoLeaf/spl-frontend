---
import type { Diagnostic } from '@/types';

interface Props {
  diagnostic: Diagnostic;
}

const { diagnostic } = Astro.props;

const statusColors = {
  healthy: 'bg-tag-healthy text-white',
  low: 'bg-tag-low text-state-idle',
  moderate: 'bg-tag-mid text-white',
  severe: 'bg-tag-severe text-white'
};

const statusColor = statusColors[diagnostic.status];

const formatDate = (date: Date): string => {
  const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                  'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
  return `${date.getDate()} de ${months[date.getMonth()]}, ${date.getFullYear()}`;
};

const formattedDate = formatDate(diagnostic.predictedAt);
---

<div class="bg-white rounded-lg border border-outline p-3 sm:p-4 hover:shadow-md transition-shadow">
  <div class="flex items-center gap-3 sm:gap-4">
    <div class="w-16 h-16 sm:w-20 sm:h-20 shrink-0 bg-gray-200 rounded-lg relative overflow-hidden">
      <div class="absolute inset-0 flex items-center justify-center text-state-disabled">
        <i class="fas fa-leaf text-2xl sm:text-3xl opacity-20"></i>
      </div>
    </div>
    
    <div class="flex-1 min-w-0">
      <h3 class="font-semibold text-state-idle text-sm sm:text-base mb-2">
        {diagnostic.statusLabel === 'Sin rancha' ? 'Hoja no afectada' : 'Hoja infectada'}
      </h3>
      
      <div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4 text-xs sm:text-sm text-state-disabled mb-2">
        <span class="inline-flex items-center gap-1">
          <i class="far fa-calendar"></i>
          {formattedDate}
        </span>
        <span class="inline-flex items-center gap-1">
          <i class={`fas fa-map-marker-alt`}></i>
          {diagnostic.location || 'Sin parcela'}
        </span>
      </div>
      
      <span class={`inline-block px-3 py-1 rounded text-xs font-medium ${statusColor}`}>
        {diagnostic.statusLabel}
      </span>
    </div>
    
    <a 
      href={`/diagnostico/${diagnostic.predictionId}`}
      class="text-state-idle text-sm font-normal hover:underline shrink-0 hidden sm:block"
    >
      Ver detalles
    </a>
  </div>
  
  <a 
    href={`/diagnostico/${diagnostic.predictionId}`}
    class="text-state-idle text-sm font-normal hover:underline mt-3 block sm:hidden"
  >
    Ver detalles
  </a>
</div>
